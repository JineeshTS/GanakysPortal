# GanaPortal API Specification

**Generated by:** ARCH-003 (API Architect)
**Date:** 2026-01-06
**Version:** 1.0
**Base URL:** `https://portal.ganakys.com/api/v1`
**Total Endpoints:** ~250

---

## API Design Principles

1. **RESTful** - Resource-based URLs, HTTP methods for actions
2. **JSON** - All requests/responses in JSON format
3. **JWT Auth** - Bearer token authentication
4. **Pagination** - Cursor-based for large datasets
5. **Versioning** - URL-based (`/api/v1/`)
6. **Error Format** - Consistent error response structure

---

## Common Response Formats

### Success Response
```json
{
  "success": true,
  "data": { ... },
  "meta": {
    "page": 1,
    "limit": 20,
    "total": 100,
    "next_cursor": "abc123"
  }
}
```

### Error Response
```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid input",
    "details": [
      {"field": "email", "message": "Invalid email format"}
    ]
  }
}
```

---

## 1. AUTHENTICATION (7 endpoints)

### POST /auth/login
Login with email/password, returns JWT tokens.

**Request:**
```json
{
  "email": "user@ganakys.com",
  "password": "SecurePass123"
}
```

**Response:**
```json
{
  "access_token": "eyJ...",
  "refresh_token": "eyJ...",
  "token_type": "Bearer",
  "expires_in": 900,
  "user": {
    "id": "uuid",
    "email": "user@ganakys.com",
    "role": "admin",
    "name": "John Doe"
  }
}
```

### POST /auth/refresh
Refresh access token using refresh token.

### POST /auth/logout
Invalidate refresh token.

### GET /auth/me
Get current user profile.

### POST /auth/change-password
Change password for authenticated user.

### POST /auth/forgot-password
Request password reset email.

### POST /auth/reset-password
Reset password with token.

---

## 2. USERS (5 endpoints)

### GET /users
List all users (Admin only).

**Query Parameters:**
- `page` - Page number
- `limit` - Items per page (default: 20)
- `role` - Filter by role
- `search` - Search by name/email

### POST /users
Create new user.

### GET /users/{id}
Get user by ID.

### PUT /users/{id}
Update user.

### DELETE /users/{id}
Soft delete user.

---

## 3. EMPLOYEES (12 endpoints)

### GET /employees
List employees with filters.

**Query Parameters:**
- `department_id` - Filter by department
- `designation_id` - Filter by designation
- `status` - active, inactive, on_notice
- `search` - Search name/code/email

### POST /employees
Create new employee.

**Request:**
```json
{
  "employee_code": "EMP001",
  "first_name": "Rajesh",
  "last_name": "Kumar",
  "date_of_joining": "2026-01-15",
  "department_id": "uuid",
  "designation_id": "uuid",
  "contact": {
    "personal_email": "rajesh@email.com",
    "personal_phone": "+919876543210"
  },
  "identity": {
    "pan": "ABCDE1234F",
    "aadhaar": "1234 5678 9012"
  }
}
```

### GET /employees/{id}
Get employee details.

### PUT /employees/{id}
Update employee.

### GET /employees/{id}/documents
List employee documents.

### POST /employees/{id}/documents
Upload employee document.

### GET /employees/{id}/salary
Get salary structure.

### PUT /employees/{id}/salary
Update salary structure.

### GET /employees/{id}/payslips
List employee payslips.

### GET /employees/{id}/leave-balance
Get leave balance.

### GET /employees/{id}/tax-declaration
Get tax declaration.

### PUT /employees/{id}/tax-declaration
Update tax declaration.

---

## 4. DEPARTMENTS & DESIGNATIONS (8 endpoints)

### Departments
- GET /departments
- POST /departments
- GET /departments/{id}
- PUT /departments/{id}

### Designations
- GET /designations
- POST /designations
- GET /designations/{id}
- PUT /designations/{id}

---

## 5. DOCUMENTS / EDMS (8 endpoints)

### Folders
- GET /folders
- POST /folders
- GET /folders/{id}
- PUT /folders/{id}

### Documents
- GET /documents
- POST /documents
- GET /documents/{id}
- DELETE /documents/{id}

### POST /documents
Upload document with AI categorization.

**Request (multipart/form-data):**
- `file` - File upload
- `folder_id` - Target folder
- `auto_categorize` - Enable AI (default: true)

**Response:**
```json
{
  "id": "uuid",
  "filename": "invoice.pdf",
  "folder_id": "uuid",
  "ai_category": "vendor_invoice",
  "ai_tags": ["invoice", "aws", "cloud"],
  "ai_confidence": 0.92
}
```

---

## 6. LEAVE MANAGEMENT (10 endpoints)

### Leave Types
- GET /leave/types
- POST /leave/types
- PUT /leave/types/{id}
- DELETE /leave/types/{id}

### Holidays
- GET /leave/holidays
- POST /leave/holidays
- PUT /leave/holidays/{id}
- DELETE /leave/holidays/{id}

### Leave Requests
### POST /leave/request
Apply for leave.

**Request:**
```json
{
  "leave_type_id": "uuid",
  "from_date": "2026-02-10",
  "to_date": "2026-02-12",
  "reason": "Personal work",
  "half_day": false
}
```

### PUT /leave/request/{id}/approve
Approve/reject leave request.

**Request:**
```json
{
  "action": "approve",
  "comments": "Approved"
}
```

---

## 7. TIMESHEET (6 endpoints)

### GET /timesheets
List timesheets.

### POST /timesheets
Create timesheet.

### GET /timesheets/{id}
Get timesheet details.

### PUT /timesheets/{id}
Update timesheet entries.

**Request:**
```json
{
  "entries": [
    {
      "project_id": "uuid",
      "task_id": "uuid",
      "date": "2026-01-06",
      "hours": 8,
      "description": "API development"
    }
  ]
}
```

### POST /timesheets/{id}/submit
Submit for approval.

### PUT /timesheets/{id}/approve
Approve timesheet.

---

## 8. PAYROLL (15 endpoints)

### Salary Components
- GET /payroll/components
- POST /payroll/components
- PUT /payroll/components/{id}
- DELETE /payroll/components/{id}

### Payroll Processing
### POST /payroll/run
Run payroll for month.

**Request:**
```json
{
  "year": 2026,
  "month": 1,
  "employee_ids": ["uuid1", "uuid2"]
}
```

**Response:**
```json
{
  "run_id": "uuid",
  "status": "processing",
  "employee_count": 5,
  "total_gross": 500000,
  "total_deductions": 75000,
  "total_net": 425000
}
```

### GET /payroll/runs
List payroll runs.

### GET /payroll/runs/{id}
Get payroll run details.

### POST /payroll/runs/{id}/finalize
Finalize payroll (create journal entries).

### GET /payslips
List payslips.

### GET /payslips/{id}
Get payslip details.

### GET /payslips/{id}/pdf
Download payslip PDF.

### GET /payroll/pf-breakdown/{employee_id}/{month}/{year}
Get PF breakdown for employee.

**Response:**
```json
{
  "pf_wage": 30000,
  "employee_pf": 3600,
  "employer_eps": 1250,
  "employer_epf": 2350,
  "total_employer": 3600,
  "total_pf_deposit": 7200
}
```

### GET /payroll/esi-breakdown/{employee_id}/{month}/{year}
Get ESI breakdown.

### GET /payroll/tds-breakdown/{employee_id}/{month}/{year}
Get TDS breakdown.

---

## 9. STATUTORY (8 endpoints)

### PF ECR
### GET /statutory/pf/ecr/{month}/{year}
Get PF ECR data.

### POST /statutory/pf/ecr/generate
Generate PF ECR file.

**Response:**
```json
{
  "file_url": "/files/ecr/Jan2026.txt",
  "employee_count": 5,
  "total_wages": 150000,
  "total_employee_pf": 18000,
  "total_employer_pf": 18000
}
```

### ESI Return
- GET /statutory/esi/return/{month}/{year}
- POST /statutory/esi/return/generate

### TDS
- GET /statutory/tds/24q/{quarter}/{year}
- POST /statutory/tds/24q/generate

### Form 16
- GET /statutory/form16/{employee_id}/{year}
- POST /statutory/form16/generate

---

## 10. ACCOUNTING (20 endpoints)

### Account Groups
- GET /accounting/groups
- POST /accounting/groups
- GET /accounting/groups/{id}
- PUT /accounting/groups/{id}

### Chart of Accounts
- GET /accounting/accounts
- POST /accounting/accounts
- GET /accounting/accounts/{id}
- PUT /accounting/accounts/{id}

### Journal Entries
### GET /accounting/journals
List journal entries.

### POST /accounting/journals
Create journal entry.

**Request:**
```json
{
  "entry_date": "2026-01-06",
  "narration": "Salary payment for Jan 2026",
  "reference": "PAY-2026-001",
  "lines": [
    {"account_id": "uuid", "debit": 500000, "credit": 0},
    {"account_id": "uuid", "debit": 0, "credit": 425000},
    {"account_id": "uuid", "debit": 0, "credit": 75000}
  ]
}
```

### GET /accounting/journals/{id}
Get journal entry.

### PUT /accounting/journals/{id}
Update journal entry (draft only).

### Reports
### GET /accounting/trial-balance
Get trial balance.

**Query Parameters:**
- `as_of` - Date for balance
- `from_date` - Period start
- `to_date` - Period end

### GET /accounting/profit-loss
Get P&L statement.

### GET /accounting/balance-sheet
Get balance sheet.

### POST /accounting/period/close
Close accounting period.

### GET /accounting/ledger/{account_id}
Get account ledger.

---

## 11. CUSTOMERS & INVOICES - AR (15 endpoints)

### Customers
- GET /customers
- POST /customers
- GET /customers/{id}
- PUT /customers/{id}

### POST /customers
Create customer.

**Request:**
```json
{
  "name": "ABC Corp",
  "gstin": "29ABCDE1234F1ZK",
  "billing_address": {
    "line1": "123 MG Road",
    "city": "Bangalore",
    "state": "Karnataka",
    "pincode": "560001"
  },
  "contact_person": "John",
  "email": "john@abccorp.com"
}
```

### Invoices
### GET /invoices
List invoices.

### POST /invoices
Create invoice.

**Request:**
```json
{
  "customer_id": "uuid",
  "invoice_date": "2026-01-06",
  "due_date": "2026-02-05",
  "line_items": [
    {
      "description": "IT Consulting Services",
      "sac_code": "998313",
      "quantity": 160,
      "unit_price": 1500,
      "gst_rate": 18
    }
  ],
  "notes": "Payment terms: Net 30"
}
```

**Response (with GST calculation):**
```json
{
  "id": "uuid",
  "invoice_number": "INV-2026-0001",
  "subtotal": 240000,
  "cgst": 21600,
  "sgst": 21600,
  "igst": 0,
  "total": 283200,
  "status": "draft"
}
```

### GET /invoices/{id}
### PUT /invoices/{id}
### GET /invoices/{id}/pdf
### POST /invoices/{id}/send

### Receipts
- GET /receipts
- POST /receipts
- GET /receipts/{id}
- POST /receipts/{id}/allocate

---

## 12. VENDORS & BILLS - AP (15 endpoints)

### Vendors
- GET /vendors
- POST /vendors
- GET /vendors/{id}
- PUT /vendors/{id}

### Bills
### GET /bills
### POST /bills
### GET /bills/{id}
### PUT /bills/{id}

### POST /bills/extract
AI extraction from bill image.

**Request (multipart/form-data):**
- `file` - Bill image/PDF

**Response:**
```json
{
  "confidence": 0.94,
  "extracted": {
    "vendor_name": "Amazon Web Services",
    "vendor_gstin": "29AAACS4345A1ZL",
    "bill_number": "INV-12345",
    "bill_date": "2026-01-01",
    "total_amount": 11800,
    "cgst": 900,
    "sgst": 900,
    "base_amount": 10000,
    "suggested_account": "Cloud Hosting Expense",
    "tds_applicable": false
  }
}
```

### Payments
- GET /payments
- POST /payments
- GET /payments/{id}
- POST /payments/{id}/allocate
- GET /vendors/{id}/tds-summary

---

## 13. BANKING (12 endpoints)

### Bank Accounts
- GET /banking/accounts
- POST /banking/accounts
- GET /banking/accounts/{id}
- PUT /banking/accounts/{id}

### Transactions
- GET /banking/transactions
- POST /banking/transactions

### Statement & Reconciliation
### POST /banking/statement/upload
Upload bank statement.

### GET /banking/reconciliation
Get reconciliation status.

### POST /banking/reconciliation/match
Manual match transaction.

### POST /banking/reconciliation/auto
AI auto-reconciliation.

**Response:**
```json
{
  "matched": 45,
  "unmatched": 3,
  "suggested_matches": [
    {
      "bank_transaction": {...},
      "suggested_entry": {...},
      "confidence": 0.89
    }
  ]
}
```

### GET /banking/petty-cash
Get petty cash entries.

---

## 14. GST COMPLIANCE (10 endpoints)

### HSN/SAC Codes
- GET /gst/hsn-sac
- POST /gst/hsn-sac
- PUT /gst/hsn-sac/{id}
- DELETE /gst/hsn-sac/{id}

### GSTR-1
### GET /gst/gstr1/{month}/{year}
Get GSTR-1 data.

**Response:**
```json
{
  "b2b": [...],
  "b2cl": [...],
  "b2cs": {...},
  "hsn_summary": [...],
  "total_taxable": 1000000,
  "total_igst": 0,
  "total_cgst": 90000,
  "total_sgst": 90000
}
```

### POST /gst/gstr1/generate
Generate GSTR-1 JSON file.

### GSTR-3B
- GET /gst/gstr3b/{month}/{year}
- POST /gst/gstr3b/generate

### Validation
- GET /gst/summary/{month}/{year}
- POST /gst/validate

---

## 15. TDS COMPLIANCE (8 endpoints)

### TDS Sections
- GET /tds/sections
- POST /tds/sections
- PUT /tds/sections/{id}
- DELETE /tds/sections/{id}

### TDS Entries
- GET /tds/entries
- POST /tds/entries

### 26Q Return
- GET /tds/26q/{quarter}/{year}

### Certificates
- POST /tds/certificates/generate

---

## 16. CRM (10 endpoints)

### Leads
### GET /crm/leads
List leads.

### POST /crm/leads
Create lead.

**Request:**
```json
{
  "company_name": "Tech Solutions",
  "contact_name": "Priya Sharma",
  "email": "priya@techsolutions.com",
  "phone": "+919876543210",
  "source": "website",
  "estimated_value": 500000
}
```

### GET /crm/leads/{id}
### PUT /crm/leads/{id}

### Pipeline
### GET /crm/pipeline
Get Kanban pipeline view.

### PUT /crm/leads/{id}/stage
Move lead to stage.

### Activities
### POST /crm/leads/{id}/activities
Add activity.

### AI Features
### GET /crm/leads/{id}/score
AI lead scoring.

**Response:**
```json
{
  "score": 78,
  "factors": [
    {"factor": "Engagement", "score": 85, "weight": 0.3},
    {"factor": "Company Size", "score": 70, "weight": 0.2},
    {"factor": "Budget Fit", "score": 80, "weight": 0.3},
    {"factor": "Timeline", "score": 75, "weight": 0.2}
  ],
  "recommendation": "High potential - prioritize follow-up"
}
```

### POST /crm/leads/{id}/email/draft
AI draft email.

### GET /crm/analytics
CRM analytics dashboard.

---

## 17. PROJECTS (15 endpoints)

### Projects
- GET /projects
- POST /projects
- GET /projects/{id}
- PUT /projects/{id}

### POST /projects
Create project.

**Request:**
```json
{
  "name": "ERP Implementation",
  "customer_id": "uuid",
  "billing_type": "fixed_price",
  "budget": 1000000,
  "start_date": "2026-01-15",
  "end_date": "2026-06-30",
  "template": "10-phase"
}
```

### Milestones
- GET /projects/{id}/milestones
- POST /projects/{id}/milestones
- PUT /milestones/{id}
- DELETE /milestones/{id}

### Tasks
- GET /projects/{id}/tasks
- POST /projects/{id}/tasks
- PUT /tasks/{id}
- DELETE /tasks/{id}

### AI Features
### POST /projects/{id}/estimate
AI estimation.

### GET /projects/{id}/health
Project health score.

### Templates
### POST /projects/template/10-phase
Apply 10-phase template.

---

## 18. AI ASSISTANT (8 endpoints)

### POST /ai/query
Natural language query.

**Request:**
```json
{
  "query": "Show me unpaid invoices over 30 days",
  "context": "accounting"
}
```

**Response:**
```json
{
  "type": "table",
  "sql_generated": "SELECT ...",
  "data": [...],
  "explanation": "Found 3 invoices overdue by more than 30 days totaling Rs. 2,50,000"
}
```

### POST /ai/extract
Extract data from document.

### POST /ai/categorize
Categorize transaction.

### GET /ai/queue
Get AI processing queue.

### PUT /ai/queue/{id}/approve
Approve AI suggestion.

### PUT /ai/queue/{id}/reject
Reject AI suggestion.

### GET /ai/briefing
Daily AI briefing.

**Response:**
```json
{
  "date": "2026-01-06",
  "highlights": [
    "3 invoices due this week totaling Rs. 5,00,000",
    "Payroll run pending for January",
    "GST filing due on 11th"
  ],
  "actions_pending": 5,
  "alerts": [
    {"type": "warning", "message": "TDS threshold approaching for vendor ABC"}
  ]
}
```

### POST /ai/action
Execute AI action.

---

## 19. QUOTES & ASSETS (12 endpoints)

### Quotes
- GET /quotes
- POST /quotes
- GET /quotes/{id}
- PUT /quotes/{id}

### POST /quotes/{id}/convert
Convert quote to project/invoice.

### Assets
- GET /assets
- POST /assets
- GET /assets/{id}
- PUT /assets/{id}

### GET /assets/{id}/depreciation
Get depreciation schedule.

### POST /assets/{id}/assign
Assign asset to employee.

### GET /assets/report
Asset register report.

---

## 20. REPORTS (10 endpoints)

### GET /reports/dashboard
Dashboard summary.

### GET /reports/trial-balance
### GET /reports/profit-loss
### GET /reports/balance-sheet
### GET /reports/cash-flow

### GET /reports/gst-summary
### GET /reports/tds-summary
### GET /reports/payroll-summary
### GET /reports/employee-cost

### POST /reports/custom
AI custom report.

---

## 21. COMPLIANCE TRACKER (6 endpoints)

### GET /compliance/calendar
Get compliance calendar.

### GET /compliance/upcoming
Get upcoming deadlines.

### POST /compliance/mark-complete
Mark compliance complete.

### GET /compliance/status
Get compliance status.

### POST /compliance/remind
Set reminder.

### GET /compliance/history
Get compliance history.

---

## Authentication

All endpoints (except `/auth/login`, `/auth/forgot-password`, `/auth/reset-password`) require:

```
Authorization: Bearer <access_token>
```

---

## Rate Limits

| Tier | Requests/min |
|------|--------------|
| Standard | 100 |
| AI Endpoints | 20 |
| Export/PDF | 10 |

---

## Webhooks

Available events:
- `invoice.created`
- `payment.received`
- `leave.approved`
- `payroll.finalized`
- `compliance.due`

---

*API Specification generated by ARCH-003 | GanaPortal Agent Army*
